{% extends "base-apps.html" %}

{% block title %}Data Visualization App{% endblock %}

{% block sidebar %}
<div class="sidebar-content">
    <div class="container">
        <button class="util-button" title="Upload Data" data-bs-toggle="tooltip" data-bs-placement="right">
            <a style="color:white;" href="#upload-data"><i class="fa-solid fa-cloud-arrow-up"></i></a>
        </button>
        
        <button class="util-button" title="Clean Data" data-bs-toggle="tooltip" data-bs-placement="right">
        <a style="color:white;" href="#clean-data"><i class="fa-solid fa-broom"></i></a>
        </button>
        
        <button class="util-button" title="Visualize Data" data-bs-toggle="tooltip" data-bs-placement="right">
            <a style="color:white;" href="#visualize-data"><i class="fa-solid fa-chart-line"></i></a>
        </button>
    </div>
</div>
{% endblock %}

{% block maincontent %}
<div class="main-content container mt-5">
    <h1 class="text-center mb-4">Welcome to the Data Visualization App</h1>

    <!-- Upload Data Section -->
    <section id="upload-data" class="mb-5">
        <h2>Upload Your Data</h2>
        <form action="{{ url_for('data_app') }}" method="POST" enctype="multipart/form-data" class="mt-3">
            <div class="input-group mb-3">
                <input type="file" id="data-file" name="data-file" accept=".csv,.xls,.xlsx" required class="form-control" />
                <button type="submit" class="btn btn-primary">Upload</button>
            </div>
        </form>
    </section>

    <!-- Data Cleaning Section -->
    <section id="clean-data" class="mb-5">
        <h2>Clean Your Data</h2>
        <p>Select cleaning operations:</p>
        <div class="card">
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="handle-missing" />
                    <label class="form-check-label" for="handle-missing">Handle Missing Values</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="remove-duplicates" />
                    <label class="form-check-label" for="remove-duplicates">Remove Duplicates</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="convert-types" />
                    <label class="form-check-label" for="convert-types">Convert Data Types</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="rename-columns" />
                    <label class="form-check-label" for="rename-columns">Rename Columns</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="handle-outliers" />
                    <label class="form-check-label" for="handle-outliers">Handle Outliers</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="clean-text" />
                    <label class="form-check-label" for="clean-text">Clean Text Data</label>
                </div>
                <button type="button" class="btn btn-secondary mt-3" id="start-cleaning">Start Cleaning</button>
            </div>
        </div>
    </section>

    <!-- Data Visualization Section -->
    <section id="visualize-data" class="mb-5">
        <h2>Visualize Your Data</h2>
        <p>Select columns and generate visualizations:</p>
        <div class="card">
            <div class="card-body">
                <div class="mb-3">
                    <label for="select-columns" class="form-label">Select Columns:</label>
                    <select id="select-columns" class="form-select" multiple>
                        <!-- Columns will be dynamically populated here -->
                    </select>
                </div>
                <div class="mb-3">
                    <label for="select-plot" class="form-label">Select Visualization Type:</label>
                    <select id="select-plot" class="form-select">
                        <option value="Histogram">Histogram</option>
                        <option value="Scatter Plot">Scatter Plot</option>
                        <option value="Line Plot">Line Plot</option>
                        <option value="Bar Chart">Bar Chart</option>
                        <option value="Box Plot">Box Plot</option>
                        <option value="Word Cloud">Word Cloud</option>
                        <option value="Heatmap">Heatmap</option>
                    </select>
                </div>
                <button type="button" class="btn btn-success" id="generate-visualization">Generate Visualization</button>
            </div>
        </div>
    </section>
</div>
{%endblock%}
{% block scripts %}
<script>
    // Populate columns dynamically after file upload
    function populateColumns(columns) {
        const select = document.getElementById('select-columns');
        select.innerHTML = ''; // Clear existing options
        columns.forEach(col => {
            const option = document.createElement('option');
            option.value = col;
            option.textContent = col;
            select.appendChild(option);
        });
    }

    // Simulate data loading from backend
    document.getElementById('start-cleaning').addEventListener('click', () => {
        alert('Data cleaning process started!');
    });

    // Generate visualization
    // Fetch possible plots based on selected columns
    function updatePlotOptions(columns) {
        const selectPlot = document.getElementById('select-plot');
        selectPlot.innerHTML = ''; // Clear existing options

        fetch('/get_plots', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ columns: columns })
        })
        .then(response => response.json())
        .then(data => {
            data.plots.forEach(plot => {
                const option = document.createElement('option');
                option.value = plot;
                option.textContent = plot;
                selectPlot.appendChild(option);
            });
        })
        .catch(error => console.error('Error fetching plots:', error));
    }

    // Handle column selection
    document.getElementById('select-columns').addEventListener('change', () => {
        const selectedColumns = Array.from(document.getElementById('select-columns').selectedOptions).map(opt => opt.value);
        updatePlotOptions(selectedColumns);
    });

    // Generate visualization
    document.getElementById('generate-visualization').addEventListener('click', () => {
        const selectedColumns = Array.from(document.getElementById('select-columns').selectedOptions).map(opt => opt.value);
        const plotType = document.getElementById('select-plot').value;

        if (selectedColumns.length === 0 || plotType === '') {
            alert('Please select columns and a visualization type.');
            return;
        }

        alert(`Generating ${plotType} for columns: ${selectedColumns.join(', ')}`);
    });
</script>
{%endblock%}