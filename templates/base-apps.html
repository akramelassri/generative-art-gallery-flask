<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generative Art Project</title>

  <!-- Bootstrap CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />

  <!-- Font Awesome 6.2 (or newer) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
  />

  <!-- Your custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/image.css') }}" />
</head>
<body>

  <!-- ============== SIDEBAR ============== -->
  <nav class="sidebar">
    <!-- Menu icon (just decorative) -->
    <a href="#" class="menu" title="Menu" data-bs-toggle="tooltip" data-bs-placement="right">
      <i class="fa-solid fa-bars"></i>
    </a>

    <!-- BRIGHTNESS ICON (opens a modal) -->
    <a
      href="#"
      class="nav-link"
      title="Brightness"
      data-bs-toggle="modal"
      data-bs-target="#brightnessModal"
      data-bs-placement="right"
    >
      <i class="fa-solid fa-sliders"></i>
    </a>

    <!-- EXAMPLE: Transformations as a dropdown with 3 sub-items -->
    <div class="dropdown" style="width: 40px; margin: 0 auto;">
      <a
        href="#"
        class="nav-link"
        data-bs-toggle="dropdown"
        title="Transformations"
        data-bs-placement="right"
      >
        <i class="fa-solid fa-burst"></i>
      </a>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">Warp</a></li>
        <li><a class="dropdown-item" href="#">Rotate</a></li>
        <li><a class="dropdown-item" href="#">Scale</a></li>
      </ul>
    </div>

    <!-- Other icons (no popups, no dropdowns, just placeholders) -->
    <a href="#" class="nav-link" title="Color Adjustments" data-bs-toggle="tooltip" data-bs-placement="right">
      <i class="fa-regular fa-eye"></i>
    </a>

    <a href="#" class="nav-link" title="Artistic Effects" data-bs-toggle="tooltip" data-bs-placement="right">
      <i class="fa-solid fa-palette"></i>
    </a>

    <a href="#" class="nav-link" title="Blur Effects" data-bs-toggle="tooltip" data-bs-placement="right">
      <i class="fa-regular fa-hand"></i>
    </a>

    <a href="#" class="nav-link" title="Save in Gallery" data-bs-toggle="tooltip" data-bs-placement="right">
      <i class="fa-regular fa-floppy-disk"></i>
    </a>

    <a href="#" class="nav-link" title="Export" data-bs-toggle="tooltip" data-bs-placement="right">
      <i class="fa-solid fa-file-export"></i>
    </a>
  </nav>

  <!-- ============== MAIN CONTENT ============== -->
  <div class="content">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h1 class="mt-3 mb-4 text-center">Image Editor</h1>
        </div>
      </div>

      <!-- IMAGE PREVIEW & UPLOAD -->
      <div class="row justify-content-center">
        <div class="col-md-8 text-center">
          <div
            id="imagePreview"
            class="d-flex align-items-center justify-content-center"
            style="
              width: 100%;
              height: 300px;
              border: 2px dashed #ccc;
              border-radius: var(--border-radius);
              background-color: #fff;
              position: relative;
              overflow: hidden;
            "
          >
            <img
              id="displayedImage"
              src=""
              alt="No image uploaded yet"
              style="max-height: 100%; max-width: 100%; display: none;"
            />
            <span id="noImageText" class="text-muted">
              No image uploaded yet (Supported: JPG, PNG, JPEG)
            </span>
          </div>

          <div class="mt-3">
            <button class="btn btn-primary" id="uploadBtn">Upload Image</button>
            <input
              type="file"
              id="fileInput"
              accept="image/png, image/jpeg, image/jpg"
              style="display: none;"
            />
          </div>
        </div>
      </div>

      <!-- UNDO & REDO -->
      <div class="row mt-4 justify-content-center">
        <div class="col-md-8 d-flex justify-content-between">
          <button class="btn btn-secondary" id="undoBtn" disabled>Undo</button>
          <button class="btn btn-secondary" id="redoBtn" disabled>Redo</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============== BRIGHTNESS MODAL (the only popup) ============== -->
  <div
    class="modal fade"
    id="brightnessModal"
    tabindex="-1"
    aria-labelledby="brightnessModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="brightnessModalLabel">Brightness</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label for="brightnessSlider" class="form-label">
            Adjust Brightness (-50 to 50):
            <span id="brightnessValue">0</span>
          </label>
          <input
            type="range"
            class="form-range"
            min="-50"
            max="50"
            step="1"
            id="brightnessSlider"
            value="0"
          />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="applyBrightnessBtn">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (with Popper) for dropdowns/tooltips -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Your JS Logic -->
  <script>
    // Initialize Bootstrap tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
      new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Basic upload & preview logic
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const displayedImage = document.getElementById('displayedImage');
    const noImageText = document.getElementById('noImageText');
    let imageHistory = [];
    let currentIndex = -1;

    uploadBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0]) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function (evt) {
          // Update history
          imageHistory = imageHistory.slice(0, currentIndex + 1);
          imageHistory.push(evt.target.result);
          currentIndex++;
          // Display
          updateImageDisplay(evt.target.result);
          updateUndoRedoButtons();
        };
        reader.readAsDataURL(file);
      }
    });

    function updateImageDisplay(src) {
      if (src) {
        displayedImage.src = src;
        displayedImage.style.display = 'block';
        noImageText.style.display = 'none';
      } else {
        displayedImage.style.display = 'none';
        noImageText.style.display = 'block';
      }
    }

    // Undo/Redo
    const undoBtn = document.getElementById('undoBtn');
    const redoBtn = document.getElementById('redoBtn');

    undoBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateImageDisplay(imageHistory[currentIndex]);
        updateUndoRedoButtons();
      }
    });

    redoBtn.addEventListener('click', () => {
      if (currentIndex < imageHistory.length - 1) {
        currentIndex++;
        updateImageDisplay(imageHistory[currentIndex]);
        updateUndoRedoButtons();
      }
    });

    function updateUndoRedoButtons() {
      undoBtn.disabled = (currentIndex <= 0);
      redoBtn.disabled = (currentIndex === imageHistory.length - 1);
    }

    // Live update for brightness slider
    document.getElementById('brightnessSlider').addEventListener('input', function() {
      document.getElementById('brightnessValue').textContent = this.value;
    });

    // Apply brightness (placeholder)
    document.getElementById('applyBrightnessBtn').addEventListener('click', () => {
      const value = document.getElementById('brightnessSlider').value;
      console.log("Brightness chosen:", value);
      // TODO: Apply brightness logic
      bootstrap.Modal.getInstance(document.getElementById('brightnessModal')).hide();
    });
  </script>
</body>
</html>
